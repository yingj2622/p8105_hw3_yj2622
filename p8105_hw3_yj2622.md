Homework 3
================
Ying Jin
2020/10/6

## Problem 1

Load the dataset

``` r
data("instacart")
```

This dataset contains 1384617 rows and 15 columns.

Observations are the level of items in orders by user. There are user/
order variables – user ID, order ID, order day and order hour. There are
also item variables – name, aisle, department, and some numeric codes.

How many aisles, and which are most products from?

``` r
instacart %>% 
  count(aisle) %>%
  nrow()
```

    ## [1] 134

``` r
instacart %>% 
  count(aisle) %>%
  arrange(desc(n))
```

    ## # A tibble: 134 x 2
    ##    aisle                              n
    ##    <chr>                          <int>
    ##  1 fresh vegetables              150609
    ##  2 fresh fruits                  150473
    ##  3 packaged vegetables fruits     78493
    ##  4 yogurt                         55240
    ##  5 packaged cheese                41699
    ##  6 water seltzer sparkling water  36617
    ##  7 milk                           32644
    ##  8 chips pretzels                 31269
    ##  9 soy lactosefree                26240
    ## 10 bread                          23635
    ## # ... with 124 more rows

There are 134 aisles and most products come from fresh vegetables.

Let’s make a plot

``` r
instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(
    aisle = factor(aisle),
    aisle = forcats::fct_reorder(aisle,n)
  ) %>% 
  ggplot(aes(x = aisle, y =n)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, vjust = .5,hjust = 1))
```

<img src="p8105_hw3_yj2622_files/figure-gfm/unnamed-chunk-3-1.png" width="90%" />

Three most popular items in three aisles

``` r
instacart %>% 
  filter(aisle %in% c("baking ingredients","dog food care","packaged vegetables fruits")) %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank < 4) %>% 
  arrange(aisle, rank) %>% 
  knitr::kable()
```

| aisle                      | product\_name                                 |    n | rank |
| :------------------------- | :-------------------------------------------- | ---: | ---: |
| baking ingredients         | Light Brown Sugar                             |  499 |    1 |
| baking ingredients         | Pure Baking Soda                              |  387 |    2 |
| baking ingredients         | Cane Sugar                                    |  336 |    3 |
| dog food care              | Snack Sticks Chicken & Rice Recipe Dog Treats |   30 |    1 |
| dog food care              | Organix Chicken & Brown Rice Recipe           |   28 |    2 |
| dog food care              | Small Dog Biscuits                            |   26 |    3 |
| packaged vegetables fruits | Organic Baby Spinach                          | 9784 |    1 |
| packaged vegetables fruits | Organic Raspberries                           | 5546 |    2 |
| packaged vegetables fruits | Organic Blueberries                           | 4966 |    3 |

Apples vs. Ice Cream

``` r
instacart %>% 
  filter(product_name %in% c("Pink Lady Apples","Coffee Ice Cream")) %>% 
  group_by(product_name,order_dow) %>% 
  summarise(
    mean_hour = mean(order_hour_of_day)
  ) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  ) %>% 
  knitr::kable()
```

    ## `summarise()` regrouping output by 'product_name' (override with `.groups` argument)

| product\_name    |        0 |        1 |        2 |        3 |        4 |        5 |        6 |
| :--------------- | -------: | -------: | -------: | -------: | -------: | -------: | -------: |
| Coffee Ice Cream | 13.77419 | 14.31579 | 15.38095 | 15.31818 | 15.21739 | 12.26316 | 13.83333 |
| Pink Lady Apples | 13.44118 | 11.36000 | 11.70213 | 14.25000 | 11.55172 | 12.78431 | 11.93750 |

## Problem 2

First, load the accelerometer dataset and tidy it.

``` r
accel_df = read_csv("./data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    cols = starts_with("activity_"),
    names_to = "minute",
    names_prefix = "activity_",
    values_to = "n_activ"
  ) %>% 
  mutate(
    weekday_vs_weekend = case_when(
      day %in% c("Monday","Tuesday","Wednesday","Thursday","Friday")~"weekday",
      day %in% c("Saturday","Sunday")~"weekend"
    ),
    day = factor(day),
    day = fct_relevel(day, c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"))
  )
```

The steps I took to wrangle the dataset include:

  - clean the column names;

  - change the dataset from wide format into long format;

  - create a new column named `weekday_vs_weekend` to indicate whether a
    certain day is a weekday or a weekend;

  - change the `day` variable into factor and relevel it.

The resulting dataset contains information about everyday “activity
counts” in each commonly one-minute intervals of a 63 year-old male
diagnosed with CHF. And the time range is five weeks.

  - It contains 50400 rows and 6 variables.

  - The dataset provides five-week observations on “activity counts” of
    a man. The counting starts at the midnight of each day and “activity
    counts” in each observations in each days are given. Also,
    information about which week a certain day belongs to, day of the
    week and whether that day is a weekday or weekend can be obtained.

Then I aggregate across minutes to create a total activity variable for
each day and create a table.

``` r
accel_df %>% 
  group_by(week, day) %>% 
  summarise(
    total_activ = sum(n_activ)
      ) %>% 
  pivot_wider(
    names_from = day,
    values_from = total_activ
  ) %>% 
  knitr::kable()
```

    ## `summarise()` regrouping output by 'week' (override with `.groups` argument)

| week |    Monday |  Tuesday | Wednesday | Thursday |   Friday | Saturday | Sunday |
| ---: | --------: | -------: | --------: | -------: | -------: | -------: | -----: |
|    1 |  78828.07 | 307094.2 |    340115 | 355923.6 | 480542.6 |   376254 | 631105 |
|    2 | 295431.00 | 423245.0 |    440962 | 474048.0 | 568839.0 |   607175 | 422018 |
|    3 | 685910.00 | 381507.0 |    468869 | 371230.0 | 467420.0 |   382928 | 467052 |
|    4 | 409450.00 | 319568.0 |    434460 | 340291.0 | 154049.0 |     1440 | 260617 |
|    5 | 389080.00 | 367824.0 |    445366 | 549658.0 | 620860.0 |     1440 | 138421 |

According to the resulting table, this man is less active on Monday and
active on the other days in the first two weeks. He is less active on
weekends, especially on Saturday, in the last two weeks.
